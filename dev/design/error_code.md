
# 错误码及错误信息的设计 #

## 使用字符串而非数字 ##

字符串形式更容易理解，尤其是客户端需要根据不同的错误码进行处理的时候，如错误信息表面某个操作已经完成时，客户端可以不进行处理，否则可能需要重试。

```java
if (!"already_done".equals(errorCode)) {
	// retry
}
```

比

```java
if (3000 != errorCode) {
	//retry
}
```

容易理解

## 使用枚举类来限定可能的错误 ##

服务器端和客户端都是Java的时候，服务器端和客户端都可以使用同样的枚举类来表示错误码，这样不容易出错。

但是要注意，远程服务接口上不能使用枚举，必须使用错误码（基本类型或者字符串），否则枚举类增加新类型后，服务器端返回的枚举实例如果在客户端的枚举类里还没有定义，反系列化的时候会出现异常。直接使用错误码则不会有这个问题，客户端收到不认识的错误码可以转换成错误枚举里的UNKNOWN实例。

有些错误码可能在一定的范围（如全局、某个业务域）内通用，也有可能只针对一个接口。

一种方式是给每个接口都定义一个枚举

- 好处是一看就知道这个接口会有什么样的错误
- 坏处是要很多枚举类，而且各个枚举类之间会有很多重复的错误码

另一种方式是定义一个统一的枚举类，包含这个应用的所有对外的错误码。可以用注释或者某些前缀来区分

```java
// -------- common error code --------
COMMON_SYSTEM_ERROR("system_error", "System error"),

// -------- client management error code --------
CLIENT_MANAGEMENT_CLIENT_NOT_EXIST("client_not_exist", "Client doesn't exist"),
```

## 错误信息 ##

明确直接：要告诉用户有用的信息，例如哪个输入参数出错了，出错原因是什么，怎么解决。如果用户可以解决，告诉用户怎么解决。

对内和对外的API的错误信息可能不一样，例如内部异常，可能对内API直接返回错误信息，对外API则不能；对内可以输出一些用于排查问题的详细数据（如买家id等），对外API则不能返回这些敏感信息。

错误信息是否提供多语言的选项？